废话说了一大堆，还是先把我的配置写出来。 
  
硬件： 
  
机箱 Silver Stone SG09. 800     (机箱小，但是限制少) 
电源 SeaSonic 650w      600     (80 Plus Gold) 
主板 INTEL DQ77MK M-ATX 1000    (有两个intel网卡，这个很关键) 
CPU  INTEL i5 2500      1200    (从一台DELL机器拆下来，折算价) 
内存 8G*4               1200    (最多只能32G。不知道将来能升64G么) 
风扇 忘记型号           300     (静音优先) 
硬盘 2T*2               1400    (升级NAS替换下来的，折算价) 
      2.5寸 160G         旧配件  (升级笔记本换下来的，折算价) 
      2.5 SSD 20G*2      500     (以前买的SLC) 
硬盘卡 LSI 1068e        350     (taobao以前买的) 
  
一共大概7500RMB左右。用集显，没配显卡。 
  
这个配置一般。我装机不行，大概就是随意挑着买。 
  
上述硬件中，CPU和主板要支持intel VT-d, 这个很关键。 
没有这个特性，没法玩虚拟机。 
  
两个2T和2.5 20G ssd都接硬盘卡上。硬盘卡刷IT模式的固件， 
相当于外置SATA卡的功能。 
160G 2.5寸接主板SATA。 
  
软件： 
  
裸机跑VMWARE ESXi 5.1. 装在2.5寸hdd上。 
这个以后需要调整。 
  
ESXi里面设置硬盘卡passthrough。 
  
第一个虚拟机为FreeBSD。添加ESXi passthrough的设备。 
这样子FreeBSD虚拟机直接能接管硬盘卡，读写硬盘是直接操作 
硬件，不通过虚拟机，达到真机性能。 
  
两个2T作为ZFS mirror配置。两个SSD各分一个小分区作为ZFS的ZIL LOG设备， 
mirror。剩下的作为ZFS的L2ARC cache。 
  
FreeBSD设置NFS共享。将ZFS的磁盘空间共享出来。 
  
然后ESXi服务器可以添加磁盘空间，添加的就是刚才FreeBSD的共享NFS。 
  
接下来，ESXi建立虚拟机的时候，选用的磁盘空间就是刚才FreeBSD提供的 
空间了。 
  
看了上面的做法，是不是有点困惑？ 
  
普通的网络存储共享，受网络带宽控制，性能并不能太好。但是我们的 
网络共享是vmware虚拟的网络设备，理论上虚拟的网卡只有1G的带宽， 
实际上带宽远远超过这个。这也就是我之前发的虚拟机里面跑的磁盘性能。 
性能非常好。 
  
更新附件的atto测试数据。还在性能调整中。读取很不错。 
